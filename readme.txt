********************************************************************
SEIB-DGVM Code descriptive document (08/Dec/2020)

Hisashi SATO (JAMSTEC)
http://seib-dgvm.com/hsato/

--- Contents ---
+ Condition of use
+ File composition
+ Procedure to run (from bare ground)
+ Procedure to run (from restart file)
+ Setting of parameter file
+ SEIB-Viewer
+ Procedure in main.f90
********************************************************************


+++++++++ Condition of Use (ver 1.0) +++++++++
1. SEIB-DGVM can be used by any researchers and by any organs for research purpose. For other usage, please contact to Dr. Hisashi SATO and obtain permission beforehand.
2. The code is provided with no guarantees as to the accuracy, correctness or utility of the output produced.
3. Modified code can be only redistributed with permissions of Dr. Hisashi SATO.
4. Publications should give adequately citation to the authors of the SEIB-DGVM (see Publications page of the SEIB-DGVM website). We really appreciate if you send us resultant publications!


+++++++++ File Composition +++++++++
+Descriptive documents (@Top folder)
readme.txt   Readme document written in English (This document)
history.txt    Update history
Model_description_??????.pdf   The latest model description (Not always up-to-date, I have to say)

+Source Code for point simulation (@Folder "code")
start_point.f90     Loader for parameter file and climate data files
modules.f90         Declaration for global parameters and variables
main_point.f90            Main loop
initialize.f90      Initialization for variables
physics.f90         Physical processes (e.g., radiation, hydrology)
metabolic.f90       Physiological Processes (e.g., photosynthesis, growth)
spatial_calc.f90    Spatial computations (e.g., radiation distribution among trees)
population_regu.f90 Plant dynamic processes (e.g., establishment, mortality, disturbance)
output.f90          Output files writer
etc.f90             Other subroutines
SFLXALL_SRC_VER_2.7.1.f90            NOAH-LSM version 2.7.1, which works with the SEIB-DGVM

+Parameter setting file (@Folder "code")
parameter.txt

+Sample climatic data to run the model at station scales (@Folder "code")
climate_AutoGenerated_Pasoh.txt
climate_AutoGenerated_Sppaskaya.txt

Sample climate data for inputting the SEIB-DGVM. 
This data was generated by the climatic data generator on the SEIB-DGVM website (http://seib-dgvm.com/data_server3.html) by specifying years for 1901~2015.
The fisrt file corresponds Pasoh forest plot(@Penisular Malaysia), which locates on latitude N 62'82, longitude E 129'83
The secound file corresponds Sppakaya-pad experimental forest (@Eastern Siberia), which locates on latitude N 2'58, longitude E 102'18.

+ Location data for inputting SEIB-DGVM (@Folder "code")
land_prop.txt     Global location data at 1 degree grid mesh. Each line corresponds to one grid mesh: the sequence is N90W180 -> N90W179 -> ... N89W180 -> ... -> S90E180. Data sequence for each line is : Land Mask (sea:0, Land:1), Elevation (m), Soil albedo, Saturation point, field capacity, Matrix potential, Wilting point, Soil Type. This file was generated from 'Input Data' of Global Soil Wetness Project 2 (http://grads.iges.org/gswp/) and  Zobler's global soil type (http://geonetwork.grid.unep.ch/geonetwork/srv/en/metadata.show?uuid=fb650de3-28d4-4461-92bd-36f5182b0de3)

+Atomospheric CO2 concentration data during 1850~2100 (@Folder "code")
co2_1850-2100_rcp**.txt
1850~2000: from the historic global mean
2001~2100: from the RCP emissions scenarios of the CMIP5 (either 2.6, 4.5, 6.0, and 8.5)

+Analysis tool for result files (@Folder "tools")
Viewer_snapshot.pov  POV-RAY code to draw virtual forest (Stop motion)
Viewer_animation.pov POV-RAY code to draw virtual forest (Sequencing)

+SEIB-Viewer (@Folder "SEIB-Viewer")
This is a GUI based program for browsing simulation result. Further explanation can be found on the lower part of this manuscript.

+MPI comuputation package (@Folder "code/mpi_package")
This package enables the SEIB-DGVM to compute multigrid cells by using MPI parallel computation. It also contains a R code for visualizing result of the multi-grid simulation. For further explanation about this package, refer readme.mpi.txt in this folder.

+++++++++ Procedure of simulation (from bare ground) +++++++++
(1) Set location to simulate
Find following lines in the start_point.f90
    LAT    = 62.017  
    LON    = 129.717
Then, set the variables LAT and LON to latitude and longitude, respectively. Range of latitude must be within -90.0 to 90.0 (-:south, +:north). Range of longitude must be within from -180 to +180 (-:west, +:east). Note, we used decadal system after decimal point.

(2) Modify parameter values in modules.f90 file, if necessary
This file contains setting values for simulation, such as maximum individual number in a plot, maximum height of forest stand, and whether output each procedure log to a file. For more descripition, read comments on the file.

(3) Specify how atmospheric CO2 concentration changes during simulations (Optional)
The default code simulates assuming that atmospheric CO2 concentration is fixed at that of year 2000. To employ time series of its historical record or IPCC RCPs, activate the following comment line, which locates in the main_point.f90.
   !co2atm = aco2_annual(min(year_climate,YearMaxCO2)) !Progress

(3) Make run file
In start_point.f90, all code files are designated by "Include" command. Thus, by compiling start_point.f90, all Fortran files will be automatically complied into a run file. Specifically, when name of executable file is specified as 'go.out', type following sentences from command line.
   f90 start_point.f90 -o go.out
The compile command ('f90' in the above example) depends on compiler; 'ifort' for Intel compiler and 'g95' for g95 Fortran compiler.
In case of the Intel Fortran, append the compile option '-assume byterecl' as fillows.
@@@ifort start_point.f90 -o go.out -assume byterecl

(4) Set parameter setting file, parameter.txt
See lower paragraph below for definitions of each parameter. At least, following two values should be modified; (a) simulation year, (b) full path directory of climate data and soil data. Note that paramter.txt should be placed at the same directory of execution file.

(5) Execute program
Type executable file name (go.out in case of the previous example) from command line. Then, several output files will be made at the same folder of this execution file.

(6) After confirming above procedure, replace climate data with data of your designated location and year. You can make it online at our web-site.


+++++++++ Procedure of simulation (from restart file) +++++++++
(1) Prepare restart file
Set a parameter 'Flag_spinup_write' in parameter.txt to ".true.". Then execute run as was mentioned before. After simulation, a restart-data-file 'spinup_out.txt' will be generated on the same directory of the execution file.

(2) Restart run
Set a parameter 'Flag_spinup_read' in parameter.txt to ".true.". Rename 'spinup_out.txt' to 'spinup_in.txt'. This file should be placed at the same directory of execution file. Then execute program as was mentioned before. Restarted simulation will be conducted for year that is specified by "Simulation_year".


+++++++++ Parameter Setting +++++++++
At the beginning of simulation run, the program read setting file (parameter.txt), then initialize the simulation condition as was specified on it. Parameters in the setting file are grouped into 10 'name lists'. Here, I will only explain parameters within 'control' name list. Definition of other parameters can be found in Sato et al. (2007). Additional explanations are also available on the module.f90. Parameters that start from "Flag_" are switches, which must be specified '.true.' or '.false.' for ON or OFF, respectively.

Simulation_year --->
Simulation year

Flag_spinup_read --->
On: starts from spin up file, Off: starts from bare ground

Flag_spinup_write --->
On: write restart file

Flag_output_write --->
On: write output files

Flag_land_physics --->
On: Activate NOAH-LSM, which simulates thermohydrology. Soil temperature in the forcing data will be ignored.
OFF: Employ the "traditional way of the SEIB" for simulating soil hydrology.

Flag_photosynthesis_type --->
Please keep OFF! Although this option enables Farquhar's model for computing photosyntheisi rate, it is still under construction.

Flag_randomization --->
On: each simulation-run can refer unique random table

Max_loc --->
One side length of virtual forest (m)

Depth --->
Depth of one soil layer (mm)

STEP --->
Vertical resolution for computation (m). This parameter determines vertical steps of crown disk height and bole height.

C_in_drymass --->
Proportion of carbon mass in dry biomass (around 0.5).

File_no --->
Devise number allocated for each output file. Avoid overlapping.

Fn_climate --->
File path for local climatic data (daily data).

Fn_CO2 --->
File path for atmospheric CO2 concentration data (annual data).

Fn_location --->
File path for global location/soil data. Eight paths should be specified for the following order: Land ocean mask, Altitude, Albedo, Field capacity, Saturation point, Matrix potential, Wilting point, Zobler's global soil types@1-degree grid

Fn_spnin  --->
File path for spinup input data.

Fn_spnout --->
File path for spinup output data.


+++++++++ SEIB-Viewer +++++++++
SEIB-Viewer is a MS-Windows application, which visualizes simulation output of SEIB-DGVM. SEIB-Viewer has to be installed on your computer.
Further explanations of this software can be found in help file that can be accessed from the application.
As I do not enough time and technical skill to maintain the code, it sometimes has problem on a latest MS-Windows.
